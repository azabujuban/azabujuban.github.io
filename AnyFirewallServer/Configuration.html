<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Configuration</title>
    <meta name="description" content="" />
    <meta name="author" content="Justin Walsh">
    <link rel="icon" href="../templates/default/themes/daux-blue/img/favicon-blue.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../templates/default/themes/daux-blue/css/daux-blue.css' rel='stylesheet' type='text/css'>
</head>
<body>
            <!-- Docs -->
                <div class="container-fluid fluid-height wrapper">
            <div class="navbar navbar-fixed-top hidden-print">
                <div class="container-fluid">
                    <a class="brand navbar-brand pull-left" href="../index">Eyeball product documentation</a>
                    <p class="navbar-text pull-right">Generated by <a href="http://daux.io">Daux.io</a></p>
                </div>
            </div>
            <div class="row columns content">
                <div class="left-column article-tree col-sm-3 hidden-print">
                    <!-- For Mobile -->
                    <div class="responsive-collapse">
                        <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                    </div>
                    <div id="sub-nav-collapse" class="sub-nav-collapse">
                        <!-- Navigation -->
                        <ul class="nav nav-list"><li><a href="../Getting_Started.html">Getting Started</a></li><li class="open"><a href="../AnyFirewallServer/index.html" class="folder">AnyFirewallServer</a><ul class="nav nav-list"><li><a href="../AnyFirewallServer/Introduction.html">Introduction</a></li><li><a href="../AnyFirewallServer/Features.html">Features</a></li><li><a href="../AnyFirewallServer/System_Requirements.html">System Requirements</a></li><li><a href="../AnyFirewallServer/Installation.html">Installation</a></li><li class="active"><a href="../AnyFirewallServer/Configuration.html">Configuration</a></li><li><a href="../AnyFirewallServer/TLS.html">TLS</a></li><li><a href="../AnyFirewallServer/Security.html">Security</a></li><li><a href="../AnyFirewallServer/Command_Line_Arguments.html">Command Line Arguments</a></li><li><a href="../AnyFirewallServer/Starting_and_Stopping.html">Starting and Stopping</a></li><li><a href="../AnyFirewallServer/Command_Line_Interface.html">Command Line Interface</a></li><li><a href="../AnyFirewallServer/User_Provisioning.html">User Provisioning</a></li><li><a href="../AnyFirewallServer/Database.html">Database</a></li><li><a href="../AnyFirewallServer/Log_Files.html">Log Files</a></li><li><a href="../AnyFirewallServer/Defaults.html">Defaults</a></li><li><a href="../AnyFirewallServer/Troubleshooting.html">Troubleshooting</a></li></ul></li><li><a href="#" class="aj-nav folder">XMPP Server</a><ul class="nav nav-list"></ul></li><li><a href="#" class="aj-nav folder">AnyFirewallEngine</a><ul class="nav nav-list"></ul></li></ul>                                                    <div class="well well-sidebar">

                                <!-- Links -->
                                <a href="http://www.eyeball.com" target="_blank">About Eyeball</a><br>                                
                                <!-- Twitter -->
                                                                    <div class="twitter">
                                        <hr/>
                                        <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=eyeballnetworks&amp;show_count=false"></iframe>
                                    </div>
                                                            </div>
                                            </div>
                </div>
                <div class="right-column float-view content-area col-sm-9">
                    <div class="content-page">
                        <article>
                                                            <div class="page-header sub-header clearfix">
                                    <h1><a href="../AnyFirewallServer">AnyFirewallServer</a>: <a href="../AnyFirewallServer/Configuration.html">Configuration</a>                                                                            </h1>
                                    <span style="float: left; font-size: 10px; color: gray;">
                                        Friday, November 14, 2014                                    </span>
                                    <span style="float: right; font-size: 10px; color: gray;">
                                        5:32 PM                                    </span>
                                </div>
                            
                            <p>The configuration file, afwd.conf, is required to run the Eyeball AnyFirewall&trade; Server. A configuration file can be created by following the steps outlined in the INSTALL file found in the server package.</p>
<hr />
<p><strong>Note:</strong> In order for the server to access the configuration file, it must be readable by the owner of the server process. If not specified by <code>-c</code> command line argument, afwd searches for the afwd.conf configuration file in the local directory</p>
<hr />
<h3>Network</h3>
<hr />
<p><strong>Note:</strong> Unless otherwise noted, it's assumed that clients are able to reach the server on the addresses and ports configured by the parameters below. When running on globally addressable addresses, make sure to open the ports in the firewall. When using a NAT or cloud environments, make sure to setup port forwarding on the NAT</p>
<hr />
<p><em>WELL, OK. I TRIED. I REALLY DID. THE DOCUMENTATION IS TOTAL SHIT. THERE ARE PARAMETERS IN SAMPLE CONF THAT ARE NEVER USED. OR NAMES THAT MAKE NO SENSE. THIS IS THE MOST IMPORTANT SECTION THAT NEEDS TO BE DOCUMENTED AND ITS COMPLETELY USELESS.</em></p>
<p><em>i have added all parameters to the table, but the need to be documented</em></p>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>enable_nat_discovery</code></td>
<td align="left">If its value is set to yes then the server will support NAT behavior discovery for clients. <em>NEED EXACT DEFINITION OF WHAT NAT BEHAVIOR DISCOVERY IS AND HOW IT WORKS</em></td>
</tr>
<tr>
<td align="left"><code>domain_name</code></td>
<td align="left">Specifies the authentication domain to be used by AnyFirewall&trade; Server. This parameter is required during the authentication process</td>
</tr>
</tbody>
</table>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>primary_IP</code></td>
<td align="left">ANY</td>
<td align="left">This numeric IP address specifies the IP addresses on which AnyFirewall&trade; Server listens for client requests. Ports and protocols on which it listens are configured by parameters that follow. Use <code>ifconfig</code> or <code>ip addr</code> commands to get a list of all available addresses. <em>THIS IS AS FAR AS I UNDERSTOOD IT, BUT I THINK THIS IS WRONG</em></td>
</tr>
<tr>
<td align="left"><code>primary_udp_port</code></td>
<td align="left">3478</td>
<td align="left">First UDP port</td>
</tr>
<tr>
<td align="left"><code>secondary_udp_port</code></td>
<td align="left">3479</td>
<td align="left">Second UDP</td>
</tr>
<tr>
<td align="left"><code>primary_tcp_port</code></td>
<td align="left">3478</td>
<td align="left">First TCP port</td>
</tr>
<tr>
<td align="left"><code>secondary_tcp_port</code></td>
<td align="left">3479</td>
<td align="left">Second TCP port</td>
</tr>
<tr>
<td align="left"><code>primary_tls_port</code></td>
<td align="left">3480</td>
<td align="left">First TLS port</td>
</tr>
<tr>
<td align="left"><code>secondary_tls_port</code></td>
<td align="left">3481</td>
<td align="left">Second TLS port</td>
</tr>
<tr>
<td align="left"><code>tcp_listen_address</code></td>
<td align="left"></td>
<td align="left"><em>NO IDEA WHY WE HAVE BOTH THIS and primary_IP</em></td>
</tr>
<tr>
<td align="left"><code>tls_listen_address</code></td>
<td align="left"></td>
<td align="left"><em>NO IDEA WHY WE HAVE BOTH THIS and primary_IP</em></td>
</tr>
<tr>
<td align="left"><code>udp_listen_address</code></td>
<td align="left"></td>
<td align="left"><em>NO IDEA WHY WE HAVE BOTH THIS and primary_IP</em></td>
</tr>
</tbody>
</table>
<h3>Stun Relay Configuration</h3>
<p><em>LATER THERE ARE REFERENCES TO <code>primary_udp_IP</code> and <code>secondary_udp_IP</code> which are parameters that do not exist</em></p>
<p>Following parameters configure the relay interface of the AnyFirewall&trade; Server. Normally, AnyFirewall&trade; Server will need an interface (IP address) and a range of ports that the peers will connect to. All these parameters are optional and unless specified, the first available IP address will be used.</p>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>first_relay_port</code></td>
<td align="left">1024</td>
<td align="left">Lowest port in the range</td>
</tr>
<tr>
<td align="left"><code>last_relay_port</code></td>
<td align="left">65535</td>
<td align="left">Highest port in the range</td>
</tr>
<tr>
<td align="left"><code>relay_interface</code></td>
<td align="left">First local IP</td>
<td align="left">An IP address that specifies a server interface that will be used to allocate ports on for relaying.  The interface can be the same as that used for the network configuration, such as primary_udp_IP, and secondary_udp_IP. Multiple relay interfaces can be specified by listing the parameter multiple times in the configuration file</td>
</tr>
<tr>
<td align="left"><code>default_lifetime_per_allocation</code></td>
<td align="left">600</td>
<td align="left">Specifies the default lifetime of a TURN allocation, in seconds. Clients need to refresh the allocation sooner than the value specified here</td>
</tr>
<tr>
<td align="left"><code>maximum_lifetime_per_allocation</code></td>
<td align="left">1800</td>
<td align="left">Specifies the maximum permitted value of a TURN allocations. Clients will not be allowed to request a longer lifetime</td>
</tr>
</tbody>
</table>
<h3>Throttling</h3>
<p><em>IT IS NOT CLEAR WHAT THE THROTTLING MECHANISM IS. MORE INFORMATION NEEDS TO BE ADDED</em></p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Mandatory/Optional</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>enable_token_per_user_throttling</code></td>
</tr>
<tr>
<td align="left"><code>server_token_per_second</code></td>
</tr>
<tr>
<td align="left"><code>server_bucket_duration</code></td>
</tr>
<tr>
<td align="left"><code>user_token_per_second</code></td>
</tr>
<tr>
<td align="left"><code>user_bucket_duration</code></td>
</tr>
</tbody>
</table>
<h3>STUN attributes</h3>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>send_software_attribute</code></td>
<td align="left"><code>yes</code></td>
<td align="left">Specifies whether the server should send STUN <code>SOFTWARE</code> attribute with every BINDING/ALLOCATE response. Can be either <code>yes</code> or <code>no</code></td>
</tr>
<tr>
<td align="left"><code>support_dont_fragment</code></td>
<td align="left"><code>yes</code></td>
<td align="left">Specifies whether the server supports the STUN <code>DONT-FRAGMENT</code> attribute in requests from the client. Can be either <code>yes</code> or <code>no</code></td>
</tr>
</tbody>
</table>
<h3>Password File</h3>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>password_file</code></td>
<td align="left">Path to a file that contains the encrypted passwords and usernames for various purposes, such as the triple-DES encryption key (user 3des), the key for the TLS certificate key file (user tls), and the database user and password</td>
</tr>
</tbody>
</table>
<h3>Logging</h3>
<p>Logging verbosity is specified by the <code>-v</code> command line argument when the server is executed. Minimum logging level is 1 and maxumum is 5.</p>
<p><em>J needs to describe exactly how this works</em></p>
<p>The server maintains 1GB of recent logs by rotating the log file. The most recent log filename is specified by <code>log_file</code>. When the size of <code>log_file</code> reaches 10MB, it is renamed and writing continues in a new <code>log_file</code></p>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>enable_log</code></td>
<td align="left"><em>OH, HOW NICE - NO DEFAULT VALUE IN CODE (otherwise we could have had an optional <code>enable_log</code> parameter just like any other normal product would</em> <code>yes</code> to enable logging or <code>no</code> to disable all logging</td>
</tr>
</tbody>
</table>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>log_file</code></td>
<td align="left"><code>/var/log/afwd.log</code></td>
<td align="left">Location of the log file</td>
</tr>
<tr>
<td align="left"><code>pid_file</code></td>
<td align="left"><code>/var/run/afwd.pid</code></td>
<td align="left">Location of the PID file that will contain the PID for the server process</td>
</tr>
<tr>
<td align="left"><code>out_file</code></td>
<td align="left">None</td>
<td align="left">STDERR is redirected to this file when running in background</td>
</tr>
</tbody>
</table>
<h3>Database Connection</h3>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>database_host</code></td>
<td align="left">The ODBC data source name of the database exactly as specified in the <code>/etc/odbc.ini</code> file</td>
</tr>
<tr>
<td align="left"><code>afwserver_id</code></td>
<td align="left">Specifies an ID for the AnyFirewall&trade; server, which is used when storing statistics in the database. When using the Eyeball Server Management system, add the server to the Eyeball Server Management's monitoring to obtain the proper ID for the server</td>
</tr>
</tbody>
</table>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>database_user</code></td>
<td align="left"><code>root</code></td>
<td align="left">A username used to connect to the database. This user should have <em>INSERT</em>, <em>DELETE</em>, <em>UPDATE</em> and <em>SELECT</em> privileges. The password for the database user specified here is stored in an encrypted format in the <a href="index.md#password-file">password file</a>. This is specified during Eyeball database installation</td>
</tr>
<tr>
<td align="left"><code>afwserver_id</code></td>
<td align="left">None</td>
<td align="left">Specifies an ID for the AnyFirewall&trade; server, which is used when storing statistics in the database. When using the Eyeball Server Management system, add the server to the Eyeball Server Management's monitoring to obtain the proper ID for the server.</td>
</tr>
<tr>
<td align="left"><code>database_log_interval</code></td>
<td align="left"><code>15</code></td>
<td align="left">Specifies (in minutes) the interval of saving statistics in database</td>
</tr>
</tbody>
</table>
<h3>TLS Certificate</h3>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>tls_cert_file</code></td>
<td align="left">Name of the file containing the certificate required for TLS. If tls_port is specified, this must be provided or the server will not start. The server certificate is expected in PEM format. Any intermediate CA certificates that must be installed in addition to the server certificate must be appended to the server certificate file</td>
</tr>
<tr>
<td align="left"><code>tls_cert_keyfile</code></td>
<td align="left">Name of the file containing the certificate key required for TLS. If tls_port is specified, this must be provided or the server will not start</td>
</tr>
<tr>
<td align="left"><code>tls_cert_user</code></td>
<td align="left">Name of the user authorized to access the certificate key specified by tls_cert_keyfile. The username is associated with the password required to access the certificate key file. The password is stored in the password file (see above). The password is generated during the setup process or later using the password utility ebpasswd</td>
</tr>
</tbody>
</table>
<h3>Administration</h3>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>admin_ip_allowed</code></td>
<td align="left">Specifies the IP address allowed to make connections to the command line interface</td>
</tr>
</tbody>
</table>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>admin_port</code></td>
<td align="left">7001</td>
<td align="left">The server listens to this TCP port to receive a telnet connection for administrative commands using the command line interface. The connection to the administration port is protected by password</td>
</tr>
</tbody>
</table>
<h3>Authentication Library</h3>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>enable_auth_library</code></td>
<td align="left"><code>n</code></td>
<td align="left">If any auth library is used then value should be set to <code>y</code> or <code>Y</code> otherwise it must be <code>n</code> or <code>N</code></td>
</tr>
<tr>
<td align="left"><code>auth_library</code></td>
<td align="left">Ignored if <code>enable_auth_library</code> is <code>n</code> or <code>N</code></td>
<td align="left">The full path to auth library should be given</td>
</tr>
</tbody>
</table>
<h3>Cloud providers support</h3>
<p>When AnyFirewall&trade; Server needs to retrieve the external IP address of the machine it's running on it uses the following three commands in succession:</p>
<ol>
<li><code>wget -qO- http://169.254.169.254/latest/meta-data/public-ipv4</code>
<ul>
<li>If running on an EC2 instance this URL contains the public (external) IP address of the instance</li>
</ul></li>
<li><code>wget -qO- http://instance-data/latest/meta-data/public-ipv4</code>
<ul>
<li>This is the old URL where EC2 instances could access the public IP information</li>
</ul></li>
<li><code>wget -qO- checkip.dyndns.org|sed -e 's/.*Current IP Address: //' -e 's/&lt;.*$//</code>
<ul>
<li>Uses IP check by <code>dyndns.org</code></li>
</ul></li>
</ol>
<h4>Mandatory parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>enable_other_stun_server_discovery</code></td>
<td align="left">If <code>yes</code> then server will discover other stun server. Else if <code>no</code> then server will not discover</td>
</tr>
<tr>
<td align="left"><code>other_stun_server_IP</code></td>
<td align="left">It is the ip address of other stun server. Can be specified multiple times. Server will choose first available stun server. If none is alive server will choose first one</td>
</tr>
<tr>
<td align="left"><code>other_stun_server_refresh_time</code></td>
<td align="left">Time in minutes by which stun server scan will be performed</td>
</tr>
</tbody>
</table>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>enable_cloud</code></td>
<td align="left"><code>no</code></td>
<td align="left">This option configures if the AFS is running within a cloud based environment. In cases when the AFS is running beneath a NAT this should also be set to <code>yes</code></td>
</tr>
<tr>
<td align="left"><code>cloud_type</code></td>
<td align="left"><code>EC2</code></td>
<td align="left">Configures the cloud type where AFS is running. If set to <code>EC2</code> (case sensitive) determines the public IP address as described previously. If set to <code>RS</code>, <code>mapped_primary_IP</code> and <code>mapped_secondary_IP</code> values must be configured manually</td>
</tr>
<tr>
<td align="left"><code>mapped_primary_IP</code>, <code>mapped_secondary_IP</code></td>
<td align="left">None</td>
<td align="left">IP Addresses of (respectively) primary and secondary STUN servers</td>
</tr>
</tbody>
</table>
<h3>Short Term credentials</h3>
<h4>Optional parameters</h4>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>short_term_credential</code></td>
<td align="left"><code>no</code></td>
<td align="left">If the value set to <code>yes</code> then short term credential mechanism used. Else if the value set to <code>no</code> then long term credential is used</td>
</tr>
</tbody>
</table>                                                    </article>
                    </div>
                </div>
            </div>
        </div>
    
                <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-12653604-10', '');ga('send', 'pageview');</script>    

    <!-- jQuery -->
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined')
                document.write(unescape("%3Cscript src='../js/jquery-1.11.0.min.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
    
    <!-- hightlight.js -->
    <script src="../js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <!-- Front end file editor -->
        <script src="../js/custom.js"></script>
    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</body>
</html>

